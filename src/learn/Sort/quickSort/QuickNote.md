# 快排

思想：
快排是一种分治思想，将一个数组分为两个子数组，其中有一个切分元素为分割点，使得：
- 对于某个j ,a[j]已经排定
- a[l,j-1]中的所有元素都不大与啊a[j]
- a[j+1,r] 中的所有元素都不小于a[j]。

按照上述 先 partition，然后递归排序，关键在于 partition
原地的 partition 是用双指针思想
与归并不同，归并是是先分，然后递归调用排序，然后再Merge,将有序的子数组归并以将整个数组排序
递归调用发生在处理整个数组(Merge)之前；
而快排每次只能确定 一个数组的最终位置，但是将整个数组排序为 左子数组 + 切分元素 +右子数组，然后每个
子数组分别递归去取。递归调用发生在处理整个个数组(partition)之后。

第一版本的快排 其实把数组元素都放在左边

partition策略：参考《算法4》P183
QuickSort.java是第一版 快排实现，但是存在缺陷,对于有序数组，其
时间复杂度会退化成 平方级别,因为 其递归深度是O(n)级别的，而归并是logn
![第一版快排的缺陷](F:\Markdown_Note\算法\第一版快排的问题.PNG)

原因及解决办法：
**原因**：每次切分元素都是默认用左边第一个，对于有序数组，
每次都是选择最小的，选择不平衡，导致后面排序就像加牙膏一点一点挤出来。
**解决办法**：切分元素随机选取
因此生成一个在 [l,r]之间的随机索引就可以了。
因此，就有了 QuickSortOptimizedByRandom 的代码

#### 双路快排
但是还是存在问题：对于数组元素都相同的数组，算法再次退化为平方级别。由此引出 "双路快排"
**思想**
将元素分成左右两边，左边小于等于V,右边大于等于V,两个指针朝中间移动，如此即可避免上述因为数组元素相同而导致算法退化的问题
循环不变量是 arr[l+1,i-1] <= V ; arr[j+1,r] >=v
![示意图](F:\Markdown_Note\算法\第二版快排示意图.PNG)

**时间复杂度分析**
快速排序是一个随机算法，其最坏的复杂度是O(n^2)。但是概率很低，所以要以数学期望来计算其时间复杂度：
平分，然后 每一层的期望值是 O(logn),而每一层都要遍历一遍所有元素，因此其复杂度期望值是O(nlogn)。

BTW: 复杂度分析中，对于普通算法，看是否能找到一组数据，使其100%达到最差的复杂度，比如第一版的快排就是 O(n^2)级别的算法。而对于随机算法，
找不到一组数据能100%恶化，就要看期望，比如双路快排。

### 三路快排
双路快排在面对全部是相同元素的数组排序时，在一次遍历，两个指针相等后，获取到p之后，还会继续对左右子数组
继续递归排序，但是实际上没必要排序,因为在partition过程中，就会发现所有元素都相同，因此根本不用排序。
**思想**
数组(除了切分元素)从左到右分别划分为 arr[l+1,lt] <V, arr[lt+1,i-1] ==V, arr[gt,r] >V 三部分
其中 lt(less than) 是 小于 V的区间的最后一个元素, gt(great than)是 大于V的区间的第一个元素。
![三路快排](F:\Markdown_Note\算法\三路快排示意图.PNG)

然后`i` 在`[lt+1,gt)`范围内遍历

1. 当i指的元素=v,`i++`;
2. 当`i`索引的元素<v,`lt++` ，`i`索引元素与`lt`索引元素交换，`i++`;
3. 当`i`索引的元素 >v,`gt--` ，`i`索引元素与`gt`索引元素交换，`i`不变;

最后当`i`遇到`gt` ，循环结束。`lt`和`l`交互位置。此时循环不变量有改动

`arr[l,lt-1]<v`,`arr[lt,gt-1] ==v`,`arr[gt,r]>v`，前两个有所改动

然后 `== V`的部分已经处在正确的位置上无需操作。接下来继续对`sort(l,lt-1)` 和`sort(gt,r)` ，执行上述操作，递归下去。

等到 i == gt的时候，遍历结束，此时要 swap(arr,l,gt),最后 `arr[l,lt-1] <V`， `arr[lt,gt-1] == V`， `arr[gt,r] >V`
如此之后，只需要对 小于或小于的区间进行递归排序。
![三路快排完成一次遍历后的结果](F:\Markdown_Note\算法\三路快排完成一次遍历后的示意图.PNG)
而如果待排序数组元素都相同，那么就只进行了一次 partition, 相等的元素都在中间区间，左右两个子数组为空，不用排序，直接结束。

双路快排和三路快排才是真正的O(nlogn)的快排，三路在面对有大量重复元素情况下更有优势。


#### 练习题
使用快排的思想做题。
215  https://leetcode-cn.com/problems/kth-largest-element-in-an-array/
40   https://leetcode-cn.com/problems/zui-xiao-de-kge-shu-lcof/

